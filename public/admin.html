<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Angelito Familiar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="style.css" />
</head>
<body class="bg-dark-admin">

  <div class="container py-4">
    <h1 class="text-center text-light mb-4">Panel de Administraci√≥n üéÑ</h1>
    <p class="text-center text-muted mb-4">
      Aqu√≠ puedes ver qui√©n fue asignado a qui√©n.
    </p>

    <div class="table-responsive">
      <table class="table table-dark table-striped align-middle">
        <thead>
          <tr>
            <th>#</th>
            <th>Nombre</th>
            <th>C√≥digo</th>
            <th>¬øYa eligi√≥?</th>
            <th>Angelito asignado</th>
          </tr>
        </thead>
        <tbody id="adminTableBody"></tbody>
      </table>
    </div>

    <div class="text-end mt-3">
      <a href="/" class="btn btn-outline-light">Volver a la p√°gina principal</a>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // Misma config que en index.html
    const firebaseConfig = {
      apiKey: "AIzaSyCSNOqqsla1tab4laMk_yS7nQkC7yFEMDs",
      authDomain: "angelito-familia.firebaseapp.com",
      projectId: "angelito-familia",
      storageBucket: "angelito-familia.firebasestorage.app",
      messagingSenderId: "543102415608",
      appId: "1:543102415608:web:0e7ba86e3b29de9a87810d",
      measurementId: "G-7RN4FRE9SR"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const tbody = document.getElementById("adminTableBody");

    async function loadAdminData() {
      tbody.innerHTML = `
        <tr>
          <td colspan="5" class="text-center text-muted">
            Cargando datos...
          </td>
        </tr>
      `;

      try {
        const snap = await getDocs(collection(db, "participants"));
        let participants = snap.docs.map(d => ({ id: d.id, ...d.data() }));

        // Ordenar por nombre para que se vea bonito
        participants.sort((a, b) => a.name.localeCompare(b.name, "es"));

        tbody.innerHTML = "";

        participants.forEach((p, index) => {
          const tr = document.createElement("tr");

          const hasPickedLabel = p.hasPicked ? "‚úÖ S√≠" : "‚ùå No";
          const angelitoLabel = p.assignedTo && p.assignedTo !== ""
            ? p.assignedTo
            : "<span class='text-warning'>Pendiente</span>";

          tr.innerHTML = `
            <td>${index + 1}</td>
            <td>${p.name}</td>
            <td><code>${p.code}</code></td>
            <td>${hasPickedLabel}</td>
            <td>${angelitoLabel}</td>
          `;

          tbody.appendChild(tr);
        });
      } catch (error) {
        console.error(error);
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="text-center text-danger">
              Error cargando datos desde Firestore. Revisa la consola.
            </td>
          </tr>
        `;
      }
    }

    loadAdminData();
  </script>
</body>
</html>