<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Angelito Familiar</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS (from CDN, free) -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="style.css" />
</head>
<body class="bg-christmas">

  <div class="overlay"></div>

  <div class="container d-flex flex-column justify-content-center align-items-center min-vh-100">
    <div class="card main-card shadow-lg">
      <div class="card-body text-center">
        <h1 class="mb-3 text-white fw-bold">
           Angelito Familiar Maldonado
        </h1>
        <p class="text-light mb-4">
          Escribe el c贸digo que recibiste para descubrir qui茅n es tu angelito.
        </p>

        <form id="codeForm" class="mb-3">
          <div class="mb-3">
            <input
              type="text"
              id="codeInput"
              class="form-control form-control-lg text-center"
              placeholder="Escribe tu c贸digo aqu铆"
              required
            />
          </div>
          <button type="submit" class="btn btn-success btn-lg w-100 fw-bold">
            Descubrir mi angelito 
          </button>
        </form>

        <div id="message" class="mt-3"></div>

        <div id="celebration" class="celebration d-none mt-4">
          <h2 class="text-warning fw-bold mb-3" id="celebrationTitle"></h2>
          <p class="text-white fs-5">
            Guarda este nombre en secreto  y prep谩rate para sorprender.
          </p>
        </div>
      </div>
    </div>

    <p class="small text-light mt-4 opacity-75">
      Proyecto familiar 路 Hecho con  y 
    </p>
  </div>

  <!-- Bootstrap JS (optional, for some helpers) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const form = document.getElementById("codeForm");
    const codeInput = document.getElementById("codeInput");
    const messageDiv = document.getElementById("message");
    const celebrationDiv = document.getElementById("celebration");
    const celebrationTitle = document.getElementById("celebrationTitle");
    const resetBtn = document.createElement("button");
    resetBtn.type = "button";
    resetBtn.className = "btn btn-outline-light btn-sm mt-2 d-none";
    resetBtn.textContent = "Inserta otro c贸digo";
    messageDiv.after(resetBtn);

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      messageDiv.innerHTML = "";
      celebrationDiv.classList.add("d-none");
      resetBtn.classList.add("d-none");

      const code = codeInput.value.trim();

      if (!code) return;

      try {
        const res = await fetch("/api/draw", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ code })
        });

        const data = await res.json();

        if (!data.success) {
          messageDiv.innerHTML = `
            <div class="alert alert-danger" role="alert">
              ${data.message || "Ocurri贸 un error. Int茅ntalo de nuevo."}
            </div>
          `;
          return;
        }

        // Success
        celebrationTitle.textContent =
          " Felicidades, tu angelito es: " + data.angelitoName + " ";

        celebrationDiv.classList.remove("d-none");

        messageDiv.innerHTML = `
          <div class="alert alert-success" role="alert">
            Tu c贸digo ha sido usado y no podr谩 volver a participar.
          </div>
        `;

        // Disable form after success
        codeInput.disabled = true;
        form.querySelector("button[type='submit']").disabled = true;
        resetBtn.classList.remove("d-none");
      } catch (error) {
        console.error(error);
        messageDiv.innerHTML = `
          <div class="alert alert-danger" role="alert">
            Error de conexi贸n. Int茅ntalo de nuevo.
          </div>
        `;
      }
    });

    resetBtn.addEventListener("click", () => {
      codeInput.disabled = false;
      codeInput.value = "";
      form.querySelector("button[type='submit']").disabled = false;
      messageDiv.innerHTML = "";
      celebrationDiv.classList.add("d-none");
      resetBtn.classList.add("d-none");
      codeInput.focus();
    });
  </script>
</body>
</html>
